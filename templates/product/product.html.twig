{% extends "base.html.twig" %}

{% set CAKE_TYPE = constant('App\\Entity\\Cake::TYPE') %}

{% block title %}{{ product.title }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" type="text/css" href="{{ asset('css/product-page.css') }}" />
{% endblock %}

{% block body %}
    <article>
        <img src="{{ asset(imageFolder ~ product.image) }}">
        <div id="product-info">
            <h1>{{ product.title }}</h1>
            <div id="description">{{ product.description }}</div>
            <p id="price">Prix : <span>{{ product.price }} €</span></p>
            <a href="{{ path("app_add_panier", {"id": product.id, "type": type}) }}"><button>Ajouter au panier</button></a>
            <p>{{ likes }} ☆</p>

        </div>
    </article>
    <div class="ratings">
        {% set currentRating = 1 %}

        {% if ratings["full"] > 0 %}
            {% for i in 1..ratings["full"]%}
                <img
                    src="{{ asset(iconsFolder ~ "star-full.svg") }}"
                    data-rating="{{ currentRating }}"
                />
                {% set currentRating = currentRating + 1 %}
            {% endfor %}
        {% endif %}

        {% if ratings["half"] > 0 %}
            {% for i in 1..ratings["half"]%}
                <img
                    src="{{ asset(iconsFolder ~ "star-half.svg") }}"
                    data-rating="{{ currentRating }}"
                />
                {% set currentRating = currentRating + 1 %}
            {% endfor %}
        {% endif %}

        {% if ratings["empty"] > 0 %}
            {% for i in 1..ratings["empty"]%}
                <img
                    src="{{ asset(iconsFolder ~ "star-empty.svg") }}"
                    data-rating="{{ currentRating }}"
                />
                {% set currentRating = currentRating + 1 %}
            {% endfor %}
        {% endif %}
        <span>({{ numRatings }})</span>
    </div>
{% endblock %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="{{ asset('js/ratings.js') }}" type="application/javascript"></script>

    <script>
        addRatingsListenerToStars(
          "{{ product.id }}",
          "{{ type }}"
        );
        addHoverListenerToStars(
          "{{ asset(iconsFolder ~ "star-empty.svg") }}",
          "{{ asset(iconsFolder ~ "star-full.svg") }}"
        );
    </script>

{% endblock %}